class ChatEngine{constructor(e,o,n){this.chatBox=$(`#${e}`),this.userEmail=o,this.userName=n;const t=this.getSocketUrl();console.log("Connecting to Socket.IO server at:",t),this.socket=io(t,{transports:["websocket","polling"],withCredentials:!0,autoConnect:!0,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3}),(this.userEmail||this.userName)&&this.connectionHandler()}getSocketUrl(){const e=window.location.hostname,o=window.location.protocol,n=window.location.port;return"localhost"===e||"127.0.0.1"===e?`${o}//${e}${n?":"+n:":8000"}`:"https://codeial-social.onrender.com"}connectionHandler(){let e=this;this.socket.on("connect",(function(){console.log("Connection established using sockets...!"),e.showConnectionStatus("Connected","success"),e.socket.emit("join_room",{user_email:e.userEmail,user_name:e.userName,chatroom:"codeial"}),e.socket.on("user_joined",(function(e){console.log("A user joined!",e)}))})),this.socket.on("connect_error",(function(o){console.error("Connection error:",o),e.showConnectionStatus("Connection failed","error")})),this.socket.on("disconnect",(function(o){console.log("Disconnected:",o),e.showConnectionStatus("Disconnected","warning")})),this.socket.on("reconnect",(function(o){console.log("Reconnected after",o,"attempts"),e.showConnectionStatus("Reconnected","success")})),this.socket.on("reconnect_error",(function(o){console.error("Reconnection failed:",o),e.showConnectionStatus("Reconnection failed","error")})),this.socket.on("error",(function(o){console.error("Socket error:",o),e.showConnectionStatus("Socket error: "+(o.message||"Unknown error"),"error")})),$("#send-message").click((function(){let o=$("#chat-message-input").val();""!=o&&e.socket.connected?(e.socket.emit("send_message",{message:o,user_email:e.userEmail,user_name:e.userName,chatroom:"codeial"}),$("#chat-message-input").val("")):e.socket.connected||e.showConnectionStatus("Not connected. Please wait...","warning")})),$("#chat-message-input").keypress((function(e){13===e.which&&$("#send-message").click()})),e.socket.on("receive_message",(function(o){console.log("Message received:",o.message);let n=$("<li>"),t="other-message";o.user_email!=e.userEmail&&o.user_name!=e.userName||(t="self-message"),n.append($("<span>",{html:o.message})),n.append($("<sub>",{html:o.user_name})),n.addClass(t),$("#chat-messages-list").append(n);const s=$("#chat-messages-list").parent();s.scrollTop(s[0].scrollHeight)}))}showConnectionStatus(e,o){$(".chat-status").remove();const n=$(`<div class="chat-status ${"success"===o?"text-success":"error"===o?"text-danger":"text-warning"} small mb-2">${e}</div>`);$("#chatbox .chat-header").length?$("#chatbox .chat-header").append(n):$("#chatbox").prepend($('<div class="chat-header"></div>').append(n)),"success"===o&&setTimeout((()=>{n.fadeOut(500,(function(){$(this).remove()}))}),3e3)}}